{"type":"javascript","name":"全网灰色，致敬英雄","version":"2","synopsis":"使全网页变灰色","tags":["工具脚本","阅读脚本"],"detail":"<p>搬运自 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/pluginDetail/43\">Via 轻插件</a> ，作者 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/user/2\">谷花泰</a></p><p><br></p><p>对原脚本进行如下修改 ：</p><ul><li>适配本站安装选项</li></ul><p><br></p><p>以下是原版介绍：</p><p><br></p><h1>全网灰色，致敬英雄</h1><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 简介</h2><p><br></p><p>人的一生，要死去三次。</p><p><br></p><p>第一次，当你的心跳停止，呼吸消逝，你在生物学上被宣告了死亡；</p><p><br></p><p>第二次，当你下葬，人们穿着黑衣出席你的葬礼，他们宣告，你在这个社会上不复存在，你从人际关系网里消逝，你悄然离去；</p><p><br></p><p>第三次死亡，是这个世界上最后一个记得你的人，把你忘记，于是，你就真正地死去。</p><p><br></p><p>我想臧克家的《有的人》就是对此最好的诠释：“有的人，他活着为了多数人更好地。…他活着为了多数人更好地活着的人，群众把他抬举得很高，很高。”</p><p><br></p><p>仅以此插件对战役逝去的同胞、前线人员哀悼，让我们永远记住他们！也对所有历史上的人民英雄致以最崇高的敬礼！</p><p><br></p><p><strong style=\"color: rgb(240, 102, 102);\">此插件用于使全部网页变灰色</strong></p><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 测试链接</h2><p><br></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://www.baidu.com/s?ie=UTF-8&amp;wd=%E8%8B%B1%E9%9B%84%E6%B0%B8%E5%9E%82%E4%B8%8D%E6%9C%BD\"><strong>测试地址</strong></a></p><h2><br></h2>","source":"/*\n * @name: 全网灰色，致敬英雄\n * @Author: 谷花泰\n * @version: 1.0\n * @description: 使全网页变灰色\n * @include: *\n * @createTime: 2020-04-04 00:22:22\n * @updateTime: 2020-04-04 00:33:12\n */\nimport config from '@bext/config';\n(function () {\n  /* 判断是否该执行 */\n  /* 网址黑名单制，遇到这些域名不执行 */\n  const blackList = config.blackList;\n\n  const hostname = window.location.hostname;\n  const key = encodeURIComponent('谷花泰:全网灰色，致敬英雄:执行判断');\n  const isBlack = blackList.some(keyword => {\n    if (hostname.match(keyword)) {\n      return true;\n    };\n    return false;\n  });\n\n  if (isBlack || window[key]) {\n    return;\n  };\n  window[key] = true;\n\n  /* 开始执行代码 */\n  class GrayBackground {\n    constructor() {\n      this.init();\n    };\n    init() {\n      this.addStyle();\n      this.selectAllNodes(node => {\n        if (!document.querySelector('style#via-gray')) {\n          this.addStyle();\n        };\n      });\n    };\n    addStyle() {\n      const styleElm = document.createElement('style');\n      styleElm.id = 'via-gray';\n      styleElm.innerHTML = `\n        html {\n          -webkit-filter: grayscale(100%);\n          filter:progid:DXImageTransform.Microsoft.BasicImage(graysale=1);\n        }\n        body {\n          filter: gray;\n        }\n      `;\n      document.head.appendChild(styleElm);\n    };\n    selectAllNodes(callback = () => { }) {\n      const allNodes = document.querySelectorAll('*');\n      Array.from(allNodes, node => {\n        callback(node);\n      });\n      this.observe({\n        targetNode: document.documentElement,\n        config: {\n          attributes: false\n        },\n        callback(mutations, observer) {\n          const allNodes = document.querySelectorAll('*');\n          Array.from(allNodes, node => {\n            callback(node);\n          });\n        }\n      });\n    };\n    observe({ targetNode, config = {}, callback = () => { } }) {\n      if (!targetNode) {\n        return;\n      };\n\n      config = Object.assign({\n        attributes: true,\n        childList: true,\n        subtree: true\n      }, config);\n\n      const observer = new MutationObserver(callback);\n      observer.observe(targetNode, config);\n    };\n  };\n  try {\n    new GrayBackground();\n  } catch (err) {\n    console.log('via插件：全网灰色运行出错');\n  };\n})();","configSchema":{"type":"object","properties":{"blackList":{"type":"array","items":{"type":"string"},"description":"网址黑名单制，遇到这些域名不执行","title":"域名黑名单"}},"required":["blackList"]},"defaultConfig":{"blackList":["example.com"]}}