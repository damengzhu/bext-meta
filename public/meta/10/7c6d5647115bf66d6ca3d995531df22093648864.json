{"type":"javascript","name":" 谷歌原生网页翻译","version":"2","synopsis":"调用谷歌翻译接口翻译整个网站","tags":["工具脚本","阅读脚本"],"detail":"<p>搬运自 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/pluginDetail/10\">Via 轻插件</a> ，作者 <a rel=\"noopener noreferrer\" href=\"http://via-app.cn/#/user/2\">谷花泰</a></p><p><br></p><p>对原脚本进行如下修改 ：</p><ul><li>适配本站安装选项 </li></ul><p><br></p><p>以下是原版介绍 ：</p><p><br></p><h1>谷歌原生网页翻译</h1><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 简介</h2><p><br></p><p>在网页自动引入谷歌官方翻译模块 ,使你可以在直接在当前网页翻译（非跳转），效果跟谷歌浏览器差不多。</p><p><br></p><p>安装后看右下角，有语言选择。</p><p><br></p><p><strong style=\"color: rgb(240, 102, 102);\">谷歌家里网络差，普通网络一般用不了，需要自行想办法，不然用不了</strong></p><p><br></p><p>由于某些大网站开启了<code style=\"background-color: rgba(27, 31, 35, 0.05); color: rgb(240, 102, 102);\"><a rel=\"noopener noreferrer\" href=\"http://www.ruanyifeng.com/blog/2016/09/csp.html\">csp名单限制</a></code>，所以有时会引入失败，比如知乎。</p><p><br></p><p>有些网页是&nbsp;<code style=\"background-color: rgba(27, 31, 35, 0.05); color: rgb(240, 102, 102);\">iframe嵌套</code>&nbsp;的，同样翻译不了，有其它问题就刷新一下。</p><p><br></p><h2><span style=\"background-color: rgb(250, 204, 204);\"> </span> 测试链接</h2><p><br></p><p><a style=\"color: rgb(240, 102, 102);\" rel=\"noopener noreferrer\" href=\"https://www.baidu.com/\">测试地址</a></p><p><br></p>","source":"/*\n * @name: 谷歌原生网页翻译\n * @Author: 谷花泰\n * @version: 2.0\n * @description: 调用谷歌翻译接口翻译整个网站\n * @include: *\n * @createTime: 2019-10-12 09:11:58\n * @updateTime   : 2020-03-16 00:51:04\n */\nimport conf from '@bext/config';\n(function () {\n  /* 判断是否该执行 */\n  /* 网址黑名单制，遇到这些域名不执行 */\n  const blackList = conf.blackList;\n\n  const hostname = window.location.hostname;\n  const key = encodeURIComponent('谷花泰:谷歌原生网页翻译:执行判断');\n  const isBlack = blackList.some(keyword => {\n    if (hostname.match(keyword)) {\n      return true;\n    };\n    return false;\n  });\n\n  if (isBlack || window[key]) {\n    return;\n  };\n  window[key] = true;\n\n  /* 开始执行代码 */\n  const config = {\n    initName: 'googleTranslate',\n    initElm: 'google_translate_elm',\n    /*多语言页面支持*/\n    multilanguagePage: conf.mlPage,\n    /* 哪种需要转 */\n    pageLanguage: conf.pageLanguage,\n    /* 能转成啥 */\n    includedLanguages: conf.includedLanguages,\n    /* 隐藏工具bar */\n    autoDisplay: conf.autoDisplay\n  };\n\n  /* 注入谷歌翻译脚本 */\n  const script = document.createElement('script');\n  script.src = `//translate.google.cn/translate_a/element.js?&cb=${config.initName}`;\n  script.async = true;\n  document.head.appendChild(script);\n\n  /* 创建谷歌翻译右下角的语言选择框容器 */\n  const div = document.createElement('div');\n  div.id = config.initElm;\n  div.setAttribute('style', `\n    position: fixed;\n    bottom: 5vw;\n    right: 5vw;\n    z-index: 999999999;\n  `);\n  document.documentElement.appendChild(div);\n\n  /* 一些样式 */\n  const style = document.createElement('style');\n  style.innerHTML = `\n    body {\n      position: relative;\n      top: 0 !important;\n      left: 0 !important;    \n    }\n    .skiptranslate iframe{\n      width: 0px !important;\n      height: 0px !important;\n      overflow: hidden;\n      display: none !important;\n    }\n    .goog-te-gadget-simple {\n      border: 1px solid #ececec !important;\n      border-radius: 4px;\n      padding: 8px;\n      line-height: 26px;\n      text-align: center;\n    }\n    .goog-te-gadget-simple a,.goog-te-gadget-simple a:link,.goog-te-gadget-simple a:visited,.goog-te-gadget-simple a:hover,.goog-te-gadget-simple a:active{\n      text-decoration: none;\n      color:inherit;\n    }\n  `;\n  document.head.appendChild(style);\n\n  /* 谷歌翻译实例化函数 */\n  window[config.initName] = () => {\n    new window.google.translate.TranslateElement({\n      layout: google.translate.TranslateElement.InlineLayout.SIMPLE,\n      multilanguagePage: config.multilanguagePage,\n      pageLanguage: config.pageLanguage,\n      includedLanguages: config.includedLanguages,\n      autoDisplay: config.autoDisplay\n    }, config.initElm);\n  };\n\n  /* 监听dom函数 */\n  function observe({ targetNode, config = {}, callback = () => { } }) {\n    if (!targetNode) {\n      return;\n    };\n    config = Object.assign({\n      attributes: true,\n      childList: true,\n      subtree: true\n    }, config);\n    const observer = new MutationObserver(callback);\n    observer.observe(targetNode, config);\n  };\n\n  /* 监听右下角的语言选择框 */\n  const initElm = document.querySelector(`#${config.initElm}`);\n  observe({\n    targetNode: initElm,\n    config: {\n      attributes: false\n    },\n    callback(mutationList, observer) {\n      /* 遍历节点 */\n      mutationList.forEach(mutation => {\n        Array.from(mutation.addedNodes, node => {\n          /* 清除 google image */\n          const googleImages = document.querySelectorAll(`#goog-gt-tt img, #${config.initElm} img`);\n          Array.from(googleImages, img => {\n            img.parentNode.removeChild(img);\n          });\n\n          /* 添加关闭按钮 */\n          if (node.className === 'goog-te-menu-value') {\n            const btnContent = document.querySelector('.goog-te-gadget-simple > span > a');\n            const closeBtn = document.createElement('span');\n            closeBtn.innerText = '关闭 | ';\n            closeBtn.addEventListener('click', (e) => {\n              initElm.parentNode.removeChild(initElm);\n              e.stopPropagation();\n            }, true);\n            btnContent.parentNode.insertBefore(closeBtn, btnContent);\n          };\n\n        });\n        /* 结束监听 */\n        observer.disconnect();\n      });\n    }\n  });\n})();","configSchema":{"type":"object","properties":{"blackList":{"type":"array","items":{"type":"string"},"title":"域名黑名单"},"mlPage":{"type":"boolean","title":"多语言页面支持"},"pageLanguage":{"type":"string","description":"哪种需要转","title":"页面语言"},"includedLanguages":{"type":"string","title":"目标语言","description":"能转成啥"},"autoDisplay":{"type":"boolean","title":"隐藏工具bar"}},"required":["mlPage","blackList","pageLanguage","includedLanguages","autoDisplay"]},"defaultConfig":{"blackList":["zhihu.com","twitter.com","wenku.baidu.com","wk.baidu.com"],"mlPage":true,"pageLanguage":"auto","includedLanguages":"zh-CN,zh-TW,en","autoDisplay":false}}