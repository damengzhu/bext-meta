{"versions":[{"hash":"d5b8d9432b4e44242307d70da5038aae7fdc248f","date":1651402723,"message":"改进介绍，加入测试页面","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1.2.2"},{"hash":"0931973285aba7971702fdaf66afc869d1e9810c","date":1651401110,"message":"调整 toast 显示时间","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1.2.2"},{"hash":"0ad123ec832cca3e2190e26ed8ba9e97b7baded8","date":1651242086,"message":"调整延时","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1.2.2"},{"hash":"a8173cb099df5cac40969f8891be344a59a68815","date":1651223182,"message":"使用 import toast, 修改版本号","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1.2.2"},{"hash":"16449e048656a0fc6e78ac107c90e519d40aa271","date":1650947715,"message":"改进 toast，移除域名限制","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1.0.0"},{"hash":"569097a8ce42ca8bdfe2cdda61c558151a107769","date":1650701153,"message":"toast 修补","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1.0.0"},{"hash":"a06f1d2301b4a329b4b388b6cd8fda1ee57f4860","date":1650633969,"message":"303001: 同步 toast ，移除 encode ，表单域名 format","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1.0.0"},{"hash":"4a2cdb096c1eac3442af08a24494d6c7c64c096c","date":1650421608,"message":"换回独立的 toast","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1.0.0"},{"hash":"798de05a0353d9c10d2daa1fa29a8caaffe5f344","date":1650416855,"message":"同步 toast","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1.0.0"},{"hash":"1ee749c2d8788995eff3cb619e8ab1ac49337dbe","date":1650415691,"message":"更新 303001 from undefined303","author_name":"Lemon399","author_email":"1446744399@qq.com","version":"1.0.0"},{"hash":"030ae74eb9e587db3f7ae9c50454d3ee4b3ae051","date":1648369432,"message":"支持安装选项","author_name":"forc","author_email":"63189191+forcux@users.noreply.github.com","version":"1.0.0"},{"hash":"7666388c98fc2a0010d2de68946bd8408a21e309","date":1648360208,"message":"添加白名单参数和询问放行参数，具体见插件注释","author_name":"undefined303","author_email":"54739035+undefined303@users.noreply.github.com","version":"1.0.0"},{"hash":"6d9518937fcd3c5c480722fd12ff1ad4ff92668a","date":1642434818,"message":"chore: 移除 Meta::build","author_name":"ikkz","author_email":"miles_yang@foxmail.com","version":"1.0.0"},{"hash":"0a57cbd4bfb78916e41c76281b99f5a978f92118","date":1640500636,"message":"修改x浏览器元信息","author_name":"undefined303","author_email":"54739035+undefined303@users.noreply.github.com","version":"1.0.0"},{"hash":"5b2e03a4b847298ef3b4a4daf4301cca2fade812","date":1640499169,"message":"添加脚本\"网页弹窗拦截\"","author_name":"undefined303","author_email":"54739035+undefined303@users.noreply.github.com","version":"1.0.0"}],"meta":{"type":"javascript","name":"网页弹窗拦截","version":"1.2.2","tags":["工具脚本","其他脚本"],"synopsis":"弹窗次数过多时询问是否拦截某弹窗","source":" /*\n * @name: 网页弹窗拦截\n * @Author: undefined303（残月un）\n * @version: 1.2.2\n * @include: *\n */\nimport { runAt, runOnce } from '@bext/util';\nimport { toast } from \"@bext/ui\";\n\nimport config from '@bext/config';\nrunOnce(()=> {\n'use strict';\n\n/*当某弹窗弹出次数达到此值的倍数时，询问是否拦截*/\n/*当询问是否拦截次数达到该值的次数时，询问是否放行，填null则不会询问*/\n/*是否用toast显示被拦截的弹窗内容？true为是，false为否*/\n/*白名单网站：将网站完整地址或域名用\"\"包裹，并用英文逗号隔开\n示例：\n     单个网站\nconst IGNORED_SITE =[\"example.com\"]\n     多个网站\nconst IGNORED_SITE =[\"example1.com\",\"https://example2.com/example\"]\n*/\n\nconst {\n  CONFIRM_COUNT = 5,\n  ASK_IGNORE_COUNT = null,\n  TOAST = true,\n  IGNORED_SITE = []\n} = config;\n/*****************以下勿改*****************/\n\nlet msgList=[];\nlet toast_var=TOAST\nif(toast_var){\nvar time=0\nrunAt('document-end', ()=>{\nvar msgListener=setInterval(()=>{\nif((Math.round(new Date())-time)>1300&&msgList.length>0){\ntoast(\n    (msgList.shift()), \n    0.7, \n    { \n      text: '本次不再显示', \n      color: 'turquoise', \n      onclick:()=>{\ntoast_var=false;\nclearInterval(msgListener);\nmsgList=[];\n},\n    },\n  );\ntime=Math.round(new Date());\n}\n},1)\n});\n}\nIGNORED_SITE.forEach((item,index) =>{\ntry{\nIGNORED_SITE[index]=new URL(item).href\n}catch(e){/*ignore error*/}\n});\nif(!(IGNORED_SITE.indexOf(document.domain)!=-1||IGNORED_SITE.indexOf(location.href)!=-1)){\nconsole.log(\"启用网页弹窗拦截\")\nconst originalConfirm =window.confirm;\n[\"alert\", \"confirm\", \"prompt\"].forEach((method) => {\nlet count = 0;\nlet count_time = 1;\nlet ignore = false;\nlet ask=true;\nconst fn = window[method] ;\nwindow[method]=function(){\nif(ignore) {\nmsgList.push(`拦截${method}: ${(arguments.length==0)?\"\":String(arguments[0])}`)\nreturn undefined;\n}\nconst result = fn((arguments.length==0)?\"\":String(arguments[0]));\ncount++;\nif (count == CONFIRM_COUNT*count_time) {\nif(ask){\nignore = originalConfirm(\n`当前网页已弹出${method}弹窗${count}次，是否忽略后续该弹窗？`);\n}\nif(ASK_IGNORE_COUNT!=null&&!ignore){\nif(count_time==ASK_IGNORE_COUNT&&originalConfirm(`是否本次放行本网站的${method}弹窗？\\n如需永久放行，请将该网站域名或完整链接添加至白名单。`)){\nask=false;\n}\n}\ncount_time++;\n}\nreturn result;\n};\n});\n}\n})","detail":"<p><br></p><p>网页弹窗有三种：alert，confirm，prompt，分别为：警告框，确认框和输入框，有的网站会滥用这三种弹窗，给用户造成极大的干扰。</p><p><br></p><p>脚本预设参数 <strong>CONFIRM_COUNT=5</strong> （可修改），当某类弹窗弹出次数达该参数的倍数时，询问是否拦截该类弹窗，拦截刷新解除。</p><p><br></p><p>测试页面 <a rel=\"noopener noreferrer\" href=\"http://www.rs100.cn/fun/fun.htm\">http://www.rs100.cn/fun/fun.htm</a></p>","extra":{"xMetaComment":"// @run-at document-start"},"configSchema":{"type":"object","properties":{"CONFIRM_COUNT":{"type":"number","description":"当某弹窗弹出次数达到此值的倍数时，询问是否拦截","minimum":1},"ASK_IGNORE_COUNT":{"type":"number","description":"当询问是否拦截次数达到该值的次数时，询问是否放行，不填则不会询问","minimum":1},"TOAST":{"type":"boolean","title":"用toast显示被拦截的弹窗内容"},"IGNORED_SITE":{"type":"array","items":{"type":"string"},"description":"例如 example.com 或者 https://example.com，点击加号添加多个","title":"白名单网站"}}},"defaultConfig":{"CONFIRM_COUNT":5,"ASK_IGNORE_COUNT":3,"TOAST":true}},"hash":"d5b8d9432b4e44242307d70da5038aae7fdc248f"}